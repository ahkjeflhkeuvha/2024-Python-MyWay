{% load static %}
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/mainpage.css' %}">
    <title>MyWay</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
</head>

<body>
    <div class="logo-container" onclick="openMain()">
        <img src="{% static 'images/MyWay.png' %}" alt="Logo">
    </div>

    <section class="search-container">
        <input type="text" name="query" id="search-bar" placeholder="ë‚˜ì˜ ì¡°í•©ì„ ê²€ìƒ‰í•´ ë³´ì„¸ìš”!">
        <img src="{% static 'images/search.png' %}" alt="Search" onclick="searchCombination()">
    </section>

    <p class="recommend">ìœ ì§„ë‹˜ì„ ìœ„í•œ <br> <span class="accent">ì¶”ì²œ ì¡°í•©</span> ì´ì—ìš”!</p>

    <div class="swiper mySwiper">
        <div class="swiper-wrapper">
            {% for combination in combis %}
            <div class="swiper-slide item" onclick="openPopup({{ combination.items|safe }}, '{{ combination.menu_name|escapejs }}')">
                <p>{{ combination.menu_name|slice:":10" }}</p>
                <img src="{{ combination.items.0.image }}" alt="{{ combination.menu_name }}">
            </div>
            {% endfor %}
        </div>
        <div class="swiper-scrollbar"></div>
    </div>

    <div class="Add-menu" onclick="choicePage()">ë‚˜ë§Œì˜ ë©”ë‰´ë¥¼ ì¶”ê°€í• ë˜ìš”! ğŸ˜‰</div>

    <!-- íŒì—… -->
    <div class="popup" id="popup" style="display: none;">
        <div class="popup-content">
            <div id="popup-items"></div>
            <span class="close-btn" onclick="closePopup()">&times;</span>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
        var swiper = new Swiper(".mySwiper", {
            slidesPerView: 2.2,
            spaceBetween: 10,
            loop: true,
            scrollbar: {
                el: ".swiper-scrollbar",
                hide: true,
            },
        });
    
        function searchCombination() {
            const inputData = document.getElementById("search-bar").value;
            // URLì— ê²€ìƒ‰ì–´ë¥¼ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ ì¶”ê°€
            const url = "{% url 'search_page' %}?search=" + encodeURIComponent(inputData);
        
            fetch(url, {
                method: "GET",
                headers: {
                    "X-CSRFToken": "{{ csrf_token }}"  // CSRF í† í°ì´ í•„ìš”í•œ ê²½ìš°ë§Œ ì¶”ê°€
                }
            })
            .then(response => response)  // ì‘ë‹µì„ JSONìœ¼ë¡œ ì²˜ë¦¬
            .then(data => {
                // ì‘ë‹µì´ ì„±ê³µì ì¼ ê²½ìš° ì²˜ë¦¬
                window.location.href = url
                console.log(data);  
                // ê²€ìƒ‰ ê²°ê³¼ í˜ì´ì§€ë¡œ ì´ë™í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸
            })
            .catch(error => {
                console.log("Error:", error);
            });
        }
        
    
        function openMain() {
            window.location.href = "{% url 'main_page' %}";
        }
    
        function choicePage() {
            window.location.href = "{% url 'choice_page' %}";
        }
    
        // íŒì—… ì—´ê¸°
        function openPopup(items, menuName) {
            const popupDiv = document.querySelector('.popup');
            let popupItemsHTML = "";
        
            console.log(items);
        
            // íŒì—…ì— menu_name ì¶”ê°€
            popupItemsHTML += `
                <div class="popupMenuName">
                    <h2>${menuName}</h2>
                </div>
            `;
        
            // ì•„ì´í…œì„ í•˜ë‚˜ì”© íŒì—…ì— ì¶”ê°€
            items.forEach(item => {
                popupItemsHTML += `
                    <div class="popupItem">
                        <img src="${item.image}" alt="${item.name}">
                        <p>${item.name}</p>
                    </div>
                `;
            });
        
            popupDiv.innerHTML = `
                <button onclick="closePopup()">X</button>
                ${popupItemsHTML}
            `;
            popupDiv.style.display = "grid"; // íŒì—… ë³´ì´ê¸°
        }
    
        function closePopup() {
            document.getElementById("popup").style.display = "none";
        }
    </script>
    
</body>

</html>
